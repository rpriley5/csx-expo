---
- name: Random line from file
  hosts: localhost
  tasks:
    - name: Count lines in file
      register: line_count
      ansible.builtin.shell: wc -l names.csv | awk '{print $1}'
      changed_when: false

    - name: Random number
      ansible.builtin.set_fact:
        random_number: "{{ line_count.stdout | random }}"

    - name: Print line at random index
      ansible.builtin.shell: head -n {{ random_number }} names.csv | tail -n 1
      changed_when: false
